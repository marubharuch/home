import{r as m,j as a,a as h,l as y,g as S,s as N,b as C}from"./index-CSAaBH09.js";function I({orderKey:l,selectedOrder:r}){const[p,u]=m.useState({}),[g,x]=m.useState(0),[s,b]=m.useState("");m.useEffect(()=>{(async()=>{if(l&&r)u(r.cart||{}),x(h(r.cart||{})),b(r.mobile||"");else{const e=await y.getItem("cart")||{};u(e),x(h(e)),e._orderInfo?.mobile&&b(e._orderInfo.mobile)}})()},[l,r]);const j=async()=>{if(!s){alert("Please enter mobile number before saving");return}const t=await getAllOrders();let e=l;if(e&&s!==r.mobile){const c=e.slice(10,14);let o=s+c+e.slice(-3);if(t[o])if(window.confirm(`Order ${o} already exists. Save as NEW order?`)){const d=Object.keys(t).filter(f=>f.slice(10,14)===c).map(f=>parseInt(f.slice(-3),10)||0),w=((d.length?Math.max(...d):0)+1).toString().padStart(3,"0");o=s+c+w}else{alert("Save cancelled.");return}e=o}if(!e)try{e=await S(s)}catch{alert("Invalid mobile number for order key generation");return}const i={cart:p,mobile:s,createdAt:e&&l?r.createdAt:new Date().toISOString()};await N(e,i),console.log("Order saved:",e,i),alert(`âœ… Order saved successfully (${e})`),await C(),u({}),x(0)},v=()=>{if(!s){alert("Please enter mobile number before sending");return}const t=Object.values(p).filter(n=>n&&n.name).map(n=>`${n.name} - â‚¹${n.finalPrice} Ã— ${n.quantity}`).join(`
`),e=`https://wa.me/91${s}?text=${encodeURIComponent(t)}`;console.log("Opening WhatsApp:",e),window.open(e,"_blank")};return a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsx("h2",{className:"text-lg font-bold",children:"ðŸ›’ Your Cart"}),l&&a.jsxs("div",{className:"bg-yellow-100 text-yellow-800 p-2 rounded",children:[a.jsx("strong",{children:"Order No:"})," ",l]}),a.jsxs("div",{children:[a.jsx("label",{className:"block mb-1",children:"Mobile Number:"}),a.jsx("input",{type:"text",value:s,onChange:t=>{const e=t.target.value.replace(/\D/g,"");e.length<=10&&b(e)},placeholder:"10-digit number",className:"border px-2 py-1 rounded w-full"})]}),a.jsx("div",{className:"space-y-2",children:Object.entries(p).filter(([t])=>t!=="_orderInfo"&&t!=="_mobile").map(([t,e])=>a.jsxs("div",{className:"border-b py-2",children:[a.jsx("div",{className:"text-sm space-y-1",children:["code","perticulers","description","name","dlp","rate"].map(n=>{const i=Object.entries(e).find(([d])=>d.toLowerCase()===n);if(!i)return null;const[c,o]=i;return a.jsx(a.Fragment,{children:a.jsxs("span",{children:[o?.toString(),"Â "]})})})}),a.jsxs("div",{className:"text-right mt-1",children:["Qty: ",e.quantity," Ã— â‚¹",e.finalPrice," ="," ",a.jsxs("span",{className:"font-bold",children:["â‚¹",(e.quantity*parseFloat(e.finalPrice)).toFixed(2)]})]})]},t))}),a.jsxs("div",{className:"font-bold",children:["Total: â‚¹",g.toFixed(2)]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:j,className:"px-4 py-2 bg-blue-600 text-white rounded",children:"ðŸ’¾ Save Order"}),a.jsx("button",{onClick:v,className:"px-4 py-2 bg-green-600 text-white rounded",children:"ðŸ“² Send via WhatsApp"})]})]})}export{I as default};
