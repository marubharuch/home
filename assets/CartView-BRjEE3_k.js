import{r as d,j as a,a as h,l as y,g as N,s as S,b as C}from"./index-BuG4n_qx.js";function $({orderKey:r,selectedOrder:n}){const[m,p]=d.useState({}),[g,x]=d.useState(0),[l,b]=d.useState("");d.useEffect(()=>{(async()=>{if(r&&n)p(n.cart||{}),x(h(n.cart||{})),b(n.mobile||"");else{const e=await y.getItem("cart")||{};p(e),x(h(e)),e._orderInfo?.mobile&&b(e._orderInfo.mobile)}})()},[r,n]);const j=async()=>{if(!l){alert("Please enter mobile number before saving");return}const t=await getAllOrders();let e=r;if(e&&l!==n.mobile){const i=e.slice(10,14);let c=l+i+e.slice(-3);if(t[c])if(window.confirm(`Order ${c} already exists. Save as NEW order?`)){const u=Object.keys(t).filter(f=>f.slice(10,14)===i).map(f=>parseInt(f.slice(-3),10)||0),w=((u.length?Math.max(...u):0)+1).toString().padStart(3,"0");c=l+i+w}else{alert("Save cancelled.");return}e=c}if(!e)try{e=await N(l)}catch{alert("Invalid mobile number for order key generation");return}const o={cart:m,mobile:l,createdAt:e&&r?n.createdAt:new Date().toISOString()};await S(e,o),console.log("Order saved:",e,o),alert(`âœ… Order saved successfully (${e})`),await C(),p({}),x(0)},v=()=>{if(!l){alert("Please enter mobile number before sending");return}const t=Object.values(m).filter(s=>s&&s.name).map(s=>`${s.name} - â‚¹${s.finalPrice} Ã— ${s.quantity}`).join(`
`),e=`https://wa.me/91${l}?text=${encodeURIComponent(t)}`;console.log("Opening WhatsApp:",e),window.open(e,"_blank")};return a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsx("h2",{className:"text-lg font-bold",children:"ðŸ›’ Your Cart"}),r&&a.jsxs("div",{className:"bg-yellow-100 text-yellow-800 p-2 rounded",children:[a.jsx("strong",{children:"Order No:"})," ",r]}),a.jsxs("div",{children:[a.jsx("label",{className:"block mb-1",children:"Mobile Number:"}),a.jsx("input",{type:"text",value:l,onChange:t=>{const e=t.target.value.replace(/\D/g,"");e.length<=10&&b(e)},placeholder:"10-digit number",className:"border px-2 py-1 rounded w-full"})]}),a.jsx("div",{className:"space-y-2",children:Object.entries(m).filter(([t])=>t!=="_orderInfo"&&t!=="_mobile").map(([t,e])=>a.jsxs("div",{className:"border-b py-2",children:[a.jsx("div",{className:"text-sm space-y-1",children:Object.entries(e).map(([s,o])=>a.jsxs("div",{className:"flex gap-1",children:[a.jsxs("span",{className:"font-semibold",children:[s,":"]}),a.jsx("span",{children:o?.toString()})]},s))}),a.jsxs("div",{className:"text-right mt-1",children:["Qty: ",e.quantity," Ã— â‚¹",e.finalPrice," ="," ",a.jsxs("span",{className:"font-bold",children:["â‚¹",(e.quantity*parseFloat(e.finalPrice)).toFixed(2)]})]})]},t))}),a.jsxs("div",{className:"font-bold",children:["Total: â‚¹",g.toFixed(2)]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:j,className:"px-4 py-2 bg-blue-600 text-white rounded",children:"ðŸ’¾ Save Order"}),a.jsx("button",{onClick:v,className:"px-4 py-2 bg-green-600 text-white rounded",children:"ðŸ“² Send via WhatsApp"})]})]})}export{$ as default};
