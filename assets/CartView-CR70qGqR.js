import{r as f,j as t,a as u,l as h,g as C,b as S,s as I,d as $}from"./index-DKuQxt82.js";function k({orderKey:d,selectedOrder:i}){const[c,p]=f.useState({}),[w,m]=f.useState(0),[r,b]=f.useState("");f.useEffect(()=>{(async()=>{if(d&&i)p(i.cart||{}),m(u(i.cart||{})),b(i.mobile||"");else{const e=await h.getItem("cart")||{};p(e),m(u(e)),e._orderInfo?.mobile&&b(e._orderInfo.mobile)}})()},[d,i]);const g=async(n,e)=>{const a={...c,[n]:{...c[n],quantity:e}};p(a),m(u(a)),await h.setItem("cart",a),window.dispatchEvent(new Event("cartUpdated")),console.log(`Quantity changed for item ${n}: ${e}`)},j=async()=>{if(!r){alert("Please enter mobile number before saving");return}const n=await C();let e=d;if(e&&r!==i.mobile){const l=e.slice(10,14);let s=r+l+e.slice(-3);if(n[s])if(window.confirm(`Order ${s} already exists. Save as NEW order?`)){const x=Object.keys(n).filter(v=>v.slice(10,14)===l).map(v=>parseInt(v.slice(-3),10)||0),N=((x.length?Math.max(...x):0)+1).toString().padStart(3,"0");s=r+l+N}else{alert("Save cancelled.");return}e=s}if(!e)try{e=await S(r)}catch{alert("Invalid mobile number for order key generation");return}const o={cart:c,mobile:r,createdAt:e&&d?i.createdAt:new Date().toISOString()};await I(e,o),console.log("Order saved:",e,o),alert(`âœ… Order saved successfully (${e})`),await $(),p({}),m(0)},y=()=>{if(!r){alert("Please enter mobile number before sending");return}const n=Object.values(c).filter(a=>a&&a.name).map(a=>`${a.name} - â‚¹${a.finalPrice} Ã— ${a.quantity}`).join(`
`),e=`https://wa.me/91${r}?text=${encodeURIComponent(n)}`;console.log("Opening WhatsApp:",e),window.open(e,"_blank")};return t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsx("h2",{className:"text-lg font-bold",children:"ðŸ›’ Your Cart"}),d&&t.jsxs("div",{className:"bg-yellow-100 text-yellow-800 p-2 rounded",children:[t.jsx("strong",{children:"Order No:"})," ",d]}),t.jsxs("div",{children:[t.jsx("label",{className:"block mb-1",children:"Mobile Number:"}),t.jsx("input",{type:"text",value:r,onChange:n=>{const e=n.target.value.replace(/\D/g,"");e.length<=10&&b(e)},placeholder:"10-digit number",className:"border px-2 py-1 rounded w-full"})]}),t.jsx("div",{className:"space-y-2",children:Object.entries(c).filter(([n])=>n!=="_orderInfo"&&n!=="_mobile").map(([n,e])=>t.jsxs("div",{className:"border-b py-2 flex items-start gap-2",children:[t.jsx("button",{onClick:()=>{if(window.confirm(`Remove "${e.name||e.description}" from cart?`)){const a={...c};delete a[n],p(a),m(u(a)),h.setItem("cart",a),window.dispatchEvent(new Event("cartUpdated"))}},className:"text-red-600 hover:text-red-800 mt-1",title:"Remove item",children:"ðŸ—‘ï¸"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-sm space-y-1",children:["code","particulers","description","name","dlp","rate"].map(a=>{const o=Object.entries(e).find(([x])=>x.toLowerCase()===a);if(!o)return null;const[l,s]=o;return t.jsxs("span",{children:[s?.toString(),"Â "]},l)})}),t.jsxs("div",{className:"text-right mt-1 flex items-center justify-end gap-2",children:[t.jsx("span",{children:"Qty:"}),t.jsx("input",{type:"number",min:"0",value:e.quantity||"",onChange:a=>{const o=a.target.value,l=o===""?"":parseFloat(o)||0;if(l<=0){if(window.confirm(`Remove "${e.name||e.description}" from cart?`)){const s={...c};delete s[n],p(s),m(u(s)),h.setItem("cart",s),window.dispatchEvent(new Event("cartUpdated"))}}else g(n,l)},className:"w-16 border rounded px-1 py-0.5 text-right"}),t.jsxs("span",{children:["Ã— â‚¹",e.finalPrice," ="]}),t.jsxs("span",{className:"font-bold",children:["â‚¹",((e.quantity||0)*parseFloat(e.finalPrice||0)).toFixed(2)]})]})]})]},n))}),t.jsxs("div",{className:"font-bold",children:["Total: â‚¹",w.toFixed(2)]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:j,className:"px-4 py-2 bg-blue-600 text-white rounded",children:"ðŸ’¾ Save Order"}),t.jsx("button",{onClick:y,className:"px-4 py-2 bg-green-600 text-white rounded",children:"ðŸ“² Send via WhatsApp"})]})]})}export{k as default};
